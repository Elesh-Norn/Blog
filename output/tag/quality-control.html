<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>A Biologist Lost in Data - Quality Control</title>
        <link rel="stylesheet" href="/Blog/theme/css/main.css" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">A Biologist Lost in Data </a></h1>
                <nav><ul>
    
                        <li><a href="/pages/about-me.html">About me</a></li>
                    <li><a href="/category/project.html">Project</a></li>
                </ul>
                </nav>
<div id="submenu">
                    <ul>
                            <li><a href="/category/project.html">Project</a></li>
                    </ul>
                <div>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="/refactoring-biology-project-part-2.html">Refactoring biology project : Part 2</a></h1>
<footer class="post-info">
        <span>mar. 30 octobre 2018</span>
        	<span>| by <a class="url fn" href="/author/daphnee-portheault.html">Daphnée PORTHEAULT</a></span>
<span>| tags: <a href="/tag/python.html">Python</a><a href="/tag/quality-control.html">Quality Control</a><a href="/tag/open-source.html">Open Source</a></span>
</footer><!-- /.post-info --><p>Hi again! </p>
<p>This blog article is a follow up on my refactoring attempt of a biology project. <a href="/refactoring-biology-project-part-1.html">Go read part 1 
if you have missed it!</a></p>
<p>First task was to make the code more readable and easier to modify. Without changing how the variable were stored
or the logic of the program, i just made helper function of the repetition. So, for the code of the earlier blog post:</p>
<div class="highlight"><pre><span></span>def get_means(data):
    temp_list = data
    #Take out concentration values
    concentrations = temp_list[:,0]
    #Remove the blanks
    concentrations = concentrations[np.logical_not(np.isnan(concentrations))]
    nan_list=np.where(np.isnan(temp_list))
    temp_list[nan_list]=np.take(concentrations, nan_list[1])

    mean_value = np.mean(temp_list, axis=0)
    x_value = temp_list[:,0]
    y_value = temp_list[:,1]

    return x_value, y_value, mean_value
</pre></div>


<blockquote>
<p>To note: This is code i used during the refactor and not final version of it.</p>
</blockquote>
<p>Ok it's ugly, not so understandable but it does the job for now. Let's just put it in a for loop and remove the old
code. What behind the code doesn't really matter in the scope of this blog post, but those functions are meant to read
an excel file, associate duplicate or triplicates of a same measure to a concentration (x against y ) and save them for
calculus and plotting later.</p>
<div class="highlight"><pre><span></span>        for elements in list_of_slices:            
             x, y , mean = helper.get_means(elements)           
             list_of_x.append(x)
             list_of_y.append(y)
             list_of_superior_y[index].append(y)
             list_of_meanind[index].append(mean)
             index += 1

        ax1.plot(list_of_x, list_of_y, &#39;ko&#39;, markersize=5)
</pre></div>


<p>With just this modifications, and progressing bit by bit, i was able to reduce more than 500 lines of code and make it
much more understandable. When this was done, i could have just stopped there but i decided that, if i wanted to make it a bit more clean and
easy to maintain/expand, i should use object oriented programming. </p>
<p>For the abstraction of the problem, i considered that a triplicate of a reading, their means (the x if you plot it), 
and it's associated concentration (the y) should be only one object. It makes accessing to a particular value easier.
I tried to keep the logic and the handling of numpy arrays from the original author as close as possible to the initial
design. (It would have been much easier to dump all files in dataframe, select the data we want and plot them easily).</p>
<p>I created so a new class called "Point", because i'm very imaginative with names.</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">Point</span><span class="p">()</span><span class="o">:</span>
    <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    Each point is associated to a concentration,</span>
<span class="s2">    coordinates (x, y), and mean</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="nx">def</span> <span class="nx">__init__</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span><span class="o">:</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">_concentration</span> <span class="o">=</span> <span class="nx">data</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="mi">0</span><span class="p">][</span><span class="nx">np</span><span class="p">.</span><span class="nx">logical_not</span><span class="p">(</span><span class="nx">np</span><span class="p">.</span><span class="nx">isnan</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))]</span>
        <span class="nx">data</span><span class="p">[</span><span class="nx">np</span><span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="nx">np</span><span class="p">.</span><span class="nx">isnan</span><span class="p">(</span><span class="nx">data</span><span class="p">))]</span> <span class="o">=</span> <span class="nx">np</span><span class="p">.</span><span class="nx">take</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">_concentration</span><span class="p">,</span>
                                                 <span class="nx">np</span><span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="nx">np</span><span class="p">.</span><span class="nx">isnan</span><span class="p">(</span><span class="nx">data</span><span class="p">))[</span><span class="mi">1</span><span class="p">])</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">_mean</span> <span class="o">=</span> <span class="nx">np</span><span class="p">.</span><span class="nx">mean</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">_x</span> <span class="o">=</span> <span class="nx">data</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">_y</span> <span class="o">=</span> <span class="nx">data</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</pre></div>


<p>As you can see, it's pretty much the same than the first function of this article and it act the same.
But now, it is morehandy. Later, we merge all the points from different files. So for example, the point at 0.5 
concentration from file A and B will get an average. So i created a <strong>Final_point</strong> class, because i'm very good with 
names.</p>
<p>But why stop the good works there? Each file, is a collection of Points coming from a csv file. Thoses files are 
separated in the file you wanna test and file of reference. So we can create an class that will parse the CSV files
and be a collection of Point and Final_point.</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">File_Parser</span><span class="o">:</span>
    <span class="s2">&quot;&quot;&quot;Create an object from datas that is a list of Points objects from the</span>
<span class="s2">    different files fed to it.</span>
<span class="s2">    Attributes:</span>
<span class="s2">        file_names (list): List of the files used to generate datas.</span>
<span class="s2">        list_of_points (list): List of the different points across a file.</span>
<span class="s2">        For more info, see the Point class.</span>
<span class="s2">        list_of_final_point (list): List of &quot;</span><span class="kr">final</span> <span class="nx">points</span><span class="s2">&quot;, for all the files in</span>
<span class="s2">        file_names aggregate all the points corresponding to one given</span>
<span class="s2">        concentration.</span>
<span class="s2">        list_of_conc (list): List of each concentration used. For now, it wont</span>
<span class="s2">        work if the files used to create data have different concentrations</span>
<span class="s2">        across them.</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="nx">def</span> <span class="nx">__init__</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span> <span class="nx">input_dic</span><span class="p">,</span> <span class="nx">data</span><span class="o">=</span><span class="nx">None</span><span class="p">,</span> <span class="nx">user_input</span><span class="o">=</span><span class="nx">None</span><span class="p">)</span><span class="o">:</span>
        <span class="s2">&quot;&quot;&quot;Initialise a File_Parser object from a list of files</span>
<span class="s2">        Args:</span>
<span class="s2">            input_dic (dict): Dictionary of user inputs(given by GUI)</span>
<span class="s2">            data (str): A string with the type of data. For now, only &#39;csv&#39; is</span>
<span class="s2">            supported. Pandas compatible file will be explored later.</span>
<span class="s2">            user_input (str): A string for input_dict. Original plan was to</span>
<span class="s2">            take all file in the same folder that finish with the same text. For</span>
<span class="s2">            example &#39;Plate1good&#39; and &#39;Plate2good&quot;</span> <span class="nx">will</span> <span class="nx">be</span> <span class="nx">parsed</span> <span class="nx">together</span> <span class="k">in</span> <span class="nx">a</span>
            <span class="nx">File_Parser</span> <span class="nx">object</span> <span class="nx">and</span> <span class="s1">&#39;good&#39;</span> <span class="nx">should</span> <span class="nx">be</span> <span class="nx">user_input</span><span class="p">.</span>
            <span class="nx">As</span> <span class="nx">the</span> <span class="nx">program</span> <span class="p">(</span><span class="k">for</span> <span class="nx">now</span><span class="p">)</span> <span class="nx">is</span> <span class="nx">built</span><span class="p">,</span> <span class="nx">we</span> <span class="nx">expect</span> <span class="nx">userinput1</span> <span class="nx">or</span>
            <span class="nx">userinput2</span><span class="p">.</span>
        <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        # Init lists</span>
<span class="s2">        self.file_names = []</span>
<span class="s2">        self.list_of_points = []</span>
<span class="s2">        self.list_of_final_point = []</span>
<span class="s2">        self.list_of_conc = []</span>
<span class="s2">        if data == &#39;csv&#39;:</span>
<span class="s2">            for files in glob.glob(&quot;</span><span class="o">*%</span><span class="nx">s</span><span class="p">.</span><span class="nx">csv</span><span class="err">&quot;</span> <span class="o">%</span> <span class="nx">user_input</span><span class="p">)</span><span class="o">:</span>
                <span class="nx">self</span><span class="p">.</span><span class="nx">file_names</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">files</span><span class="p">)</span>
                <span class="err">#</span> <span class="nx">This</span> <span class="nx">is</span> <span class="nx">the</span> <span class="nx">delimitation</span> <span class="nx">used</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">original</span> <span class="nx">repository</span> <span class="nx">and</span>
                <span class="err">#</span> <span class="nx">the</span> <span class="nx">files</span> <span class="nx">i</span><span class="s1">&#39;m using to test the program. We could extend the</span>
<span class="s1">                # program to let user choose the data input (here it&#39;</span><span class="nx">s</span> <span class="nx">array</span><span class="p">)</span>
                <span class="nx">array</span> <span class="o">=</span> <span class="nx">np</span><span class="p">.</span><span class="nx">genfromtxt</span><span class="p">(</span><span class="nx">files</span><span class="p">,</span> <span class="nx">delimiter</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">,</span>
                                      <span class="nx">skip_header</span><span class="o">=</span><span class="nx">input_dic</span><span class="p">[</span><span class="s1">&#39;user_input3&#39;</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                      <span class="nx">usecols</span><span class="o">=</span><span class="p">(</span><span class="nx">input_dic</span><span class="p">[</span><span class="s1">&#39;user_input4&#39;</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                               <span class="nx">input_dic</span><span class="p">[</span><span class="s1">&#39;user_input5&#39;</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
                <span class="nx">list_of_slices</span> <span class="o">=</span> <span class="p">[</span><span class="nx">array</span><span class="p">[</span><span class="nx">0</span>:<span class="kt">3</span><span class="p">],</span> <span class="nx">array</span><span class="p">[</span><span class="nx">3</span>:<span class="kt">6</span><span class="p">],</span> <span class="nx">array</span><span class="p">[</span><span class="nx">6</span>:<span class="kt">9</span><span class="p">],</span> <span class="nx">array</span><span class="p">[</span><span class="nx">9</span>:<span class="kt">12</span><span class="p">],</span>
                                  <span class="nx">array</span><span class="p">[</span><span class="nx">12</span>:<span class="kt">15</span><span class="p">],</span> <span class="nx">array</span><span class="p">[</span><span class="nx">15</span>:<span class="kt">18</span><span class="p">],</span> <span class="nx">array</span><span class="p">[</span><span class="nx">18</span>:<span class="kt">21</span><span class="p">],</span>
                                  <span class="nx">array</span><span class="p">[</span><span class="nx">21</span>:<span class="kt">24</span><span class="p">]]</span>

                <span class="k">for</span> <span class="nx">elements</span> <span class="k">in</span> <span class="nx">list_of_slices</span>:
                    <span class="kt">point</span> <span class="o">=</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">elements</span><span class="p">)</span>
                    <span class="nx">self</span><span class="p">.</span><span class="nx">list_of_points</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">point</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nx">point</span><span class="p">.</span><span class="nx">mean</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="nx">not</span> <span class="k">in</span> <span class="nx">self.list_of_conc</span>:
                        <span class="kt">self.list_of_conc.append</span><span class="p">(</span><span class="nx">point</span><span class="p">.</span><span class="nx">mean</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="nx">elif</span> <span class="nx">data</span> <span class="o">==</span> <span class="s1">&#39;pandas&#39;</span><span class="o">:</span>
            <span class="err">#</span> <span class="nx">Pandas</span> <span class="nx">handling</span> <span class="nx">is</span> <span class="nx">planned</span><span class="p">.</span> <span class="nx">Pandas</span> <span class="nx">is</span> <span class="nx">much</span> <span class="nx">more</span> <span class="nx">easier</span> <span class="nx">to</span> <span class="nx">use</span>
            <span class="err">#</span> <span class="nx">than</span> <span class="nx">random</span> <span class="nx">arrays</span> <span class="nx">and</span> <span class="nx">would</span> <span class="nx">require</span> <span class="nx">an</span> <span class="nx">formated</span> <span class="nx">input</span> <span class="kd">with</span> <span class="nx">clear</span>
            <span class="err">#</span> <span class="nx">labels</span> <span class="nx">on</span> <span class="nx">values</span><span class="p">.</span>
            <span class="nx">pass</span>
        <span class="k">else</span><span class="o">:</span>
            <span class="nx">print</span><span class="p">(</span><span class="s1">&#39;Unknown data format&#39;</span><span class="p">)</span>

        <span class="nx">self</span><span class="p">.</span><span class="nx">mask</span> <span class="o">=</span> <span class="nx">list</span><span class="p">(</span><span class="nx">range</span><span class="p">(</span><span class="nx">len</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">file_names</span><span class="p">)))</span>
        <span class="err">#</span> <span class="nx">Take</span> <span class="nx">all</span> <span class="nx">points</span> <span class="nx">of</span> <span class="nx">a</span> <span class="nx">same</span> <span class="nx">concentration</span> <span class="nx">and</span> <span class="nx">average</span> <span class="nx">them</span> <span class="nx">into</span> <span class="nx">the</span>
        <span class="err">#</span> <span class="nx">Final_point</span> <span class="kr">class</span>
        <span class="k">for</span> <span class="nx">concentration</span> <span class="k">in</span> <span class="nx">self.list_of_conc</span>:
            <span class="kt">dummy_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="nx">point</span> <span class="k">in</span> <span class="nx">self.list_of_points</span>:
                <span class="kt">if</span> <span class="nx">point</span><span class="p">.</span><span class="nx">mean</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="nx">concentration</span>:
                    <span class="kt">dummy_list.append</span><span class="p">(</span><span class="nx">point</span><span class="p">)</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">list_of_final_point</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">Final_point</span><span class="p">(</span><span class="nx">dummy_list</span><span class="p">))</span>
</pre></div>


<p>And now the program is somewhat correct. It can be more easily expanded and corrected upon. </p>
<p>And it seem to work : </p>
<p><img alt="output" src="/image/Example_ELISA_QC_Result.png"></p>
<p>At the time i write this line, my pull request has not been accepted. You can find my full refactoring on github 
<a href="https://github.com/Elesh-Norn/ELISA_QC">here</a>. I could expand the project by making the data selection easier, pandas 
compatible or other things but i have also other projects as you will see in future blog posts ; )</p>                </article>
            </aside><!-- /#featured -->
                <section id="content" class="body">
                    <h1>Other articles</h1>
                    <ol id="posts-list" class="hfeed">

            <li><article class="hentry">
                <header>
                    <h1><a href="/refactoring-biology-project-part-1.html" rel="bookmark"
                           title="Permalink to Refactoring biology project : Part 1">Refactoring biology project : Part 1</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <span>lun. 29 octobre 2018</span>
        	<span>| by <a class="url fn" href="/author/daphnee-portheault.html">Daphnée PORTHEAULT</a></span>
<span>| tags: <a href="/tag/python.html">Python</a><a href="/tag/quality-control.html">Quality Control</a><a href="/tag/open-source.html">Open Source</a></span>
</footer><!-- /.post-info -->                <p>One of my first coding exercise after having getting introductory certificates in python programmation
is an open project. Due to work at my lab, i had to set up a quality control scheme on our ELISAs.
ELISAs is a method to assay proteins. Quickly said, we put some chemicals and …</p>
                <a class="readmore" href="/refactoring-biology-project-part-1.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>
            </ol><!-- /#posts-list -->
            </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                            <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                            <li><a href="https://github.com/nasskach/pelican-blueidea">Theme by Nasskach</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="https://github.com/Elesh-Norn">Github</a></li>
                            <li><a href="https://www.linkedin.com/in/daphn%C3%A9e-portheault-96b2b810a/">Linkedin</a></li>
                            <li><a href="mailto:daphnee.portheault@protonmail.com">Email</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <p>Powered by <a href="http://getpelican.com/">Pelican</a>. Theme <a href="https://github.com/blueicefield/pelican-blueidea/">blueidea</a>, inspired by the default theme.</p>
        </footer><!-- /#contentinfo -->

</body>
</html>